(function(){function t(t,n,r){function o(e){var t=document.createElement("a");t.href=e;e+=t.search?"&":"?";e+="now="+(new Date).getTime();return e}function u(){e.debug("HTTP open",t,n);s.open(t,n);var i=r?JSON.stringify(r):null;e.debug("XHR send",i,s);s.send(i)}e.debug("HTTP",t,n);var i=this,s=i.xhr=new XMLHttpRequest;if($.os.android){e.debug("Add timestamp to URL for Android OS");n=o(n)}var a=$.os.android?3e3:1e4,f=0;s.timerId=setTimeout(function(){e.debug("HTTP timeout",t,n);s.abort();i.trigger("loaded",s);i.trigger("error",{code:"timeout",message:"timeout"})},a);s.onreadystatechange=function(){if(f===4)return;var r=s.readyState;f=r;e.debug("xhr state",r,r===4);if(r===4){var o=s.status;e.debug("xhr status",o,t,n,s.responseText);if(o===0){e.debug("xhr status aborted");return}clearTimeout(s.timerId);var u;e.debug("xhr response text",s.responseText);s.responseText.charAt(0)==="{"?u=JSON.parse(s.responseText):u=s.responseText;e.debug("xhr response object",u);var a;if(200<=o&&o<300){e.debug("HTTP OK",t,n,s);a="complete"}else{e.error("HTTP",s.statusText,t,n);a="error"}i.trigger(a,u)}else if(r<4){var l=["init","loading","loaded","interactive"][r];e.debug("HTTP state type",l,t,n);i.trigger(l,s)}};setTimeout(u,0)}var e=$.log;$.listenize(t);$.http={get:function(){var e=Array.prototype.slice.apply(arguments),n=e[0],r=e[1];if(e.length===3){n=n+"?"+query(e[1]);r=e[2]}return new t("GET",n,null,r)},post:function(e,n,r){return new t("POST",e,n,r)},put:function(e,n,r){return new t("PUT",e,n,r)},del:function(e,n){return new t("DELETE",e,n)}}})();